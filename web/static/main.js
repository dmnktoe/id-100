"use strict";(()=>{function p(){let r=document.querySelector(".brand-full"),i=document.querySelector(".brand-compact");r&&sessionStorage.getItem("brandAnimated")==="1"&&(r.classList.add("reverse-animated"),sessionStorage.setItem("brandAnimated","0"),setTimeout(()=>{r.classList.remove("reverse-animated")},800)),i&&sessionStorage.getItem("brandAnimated")!=="1"&&(i.classList.add("animated"),sessionStorage.setItem("brandAnimated","1"))}function f(r){let o=Array.from((r||document).querySelectorAll("img.lazy"));if(o.length===0)return;let c=e=>{let t=e.getAttribute("data-lqip");t&&(!e.getAttribute("src")||e.getAttribute("src")?.[0]==="#")&&(e.src=t)};if(o.forEach(e=>{if(e.dataset.lazyInitialized)return;e.dataset.lazyInitialized="1";let t=()=>{let s=e.getAttribute("data-src");try{let a=e.currentSrc||e.src||"";(!s||a===s)&&e.classList.add("loaded")}catch{e.classList.add("loaded")}},n=()=>{e.classList.add("loaded")};e.addEventListener("load",t),e.addEventListener("error",n),c(e),e.complete&&(e.naturalWidth&&e.naturalWidth>0?t():n())}),"IntersectionObserver"in window){let e=new IntersectionObserver((t,n)=>{t.forEach(s=>{if(!s.isIntersecting)return;let a=s.target,l=a.getAttribute("data-src");l&&a.src!==l&&(a.src=l),n.unobserve(a)})},{root:null,rootMargin:"200px",threshold:.01});o.forEach(t=>{t.classList.contains("loaded")||e.observe(t)})}else o.forEach(e=>{let t=e.getAttribute("data-src");t&&!e.classList.contains("loaded")&&e.src!==t&&(e.src=t)})}function g(){let r=document.getElementById("drawer-panel"),i=document.getElementById("drawer-backdrop");if(!r||!i)return;function o(e){let t=r.dataset.drawerPushed==="true";document.body.classList.remove("drawer-open"),r.innerHTML="",r.setAttribute("aria-hidden","true"),i.setAttribute("aria-hidden","true"),e&&t&&history.back(),delete r.dataset.drawerPushed}function c(e,t,n,s){r.innerHTML=t,r.setAttribute("aria-hidden","false"),i.setAttribute("aria-hidden","false"),document.body.classList.add("drawer-open");let a=r.querySelector(".drawer-close");a&&a.addEventListener("click",()=>o(!0),{once:!0});let l=r.querySelector(".drawer-back-link");l&&l.addEventListener("click",d=>{d.preventDefault(),o(!0)},{once:!0});try{f(r),Array.from(r.querySelectorAll("img.lazy")).forEach(d=>{let m=d.getAttribute("data-src");m&&d.src!==m&&(d.src=m)})}catch(d){console.warn("initLazyImages failed",d)}if(n){let d=s?`/id/${e}?page=${s}`:`/id/${e}`;history.pushState({drawer:!0,number:e,page:s},"",d),r.dataset.drawerPushed="true"}else r.dataset.drawerPushed="false"}i.addEventListener("click",()=>o(!0)),document.addEventListener("click",e=>{let t=e.target.closest(".id-card");if(!t)return;e.preventDefault();let n=t.getAttribute("href")||t.querySelector("a")?.getAttribute("href");if(!n)return;let s=n.match(/\/id\/(\d+)/);if(!s)return;let a=s[1],d=new URL(n,window.location.origin).searchParams.get("page"),m=d?`/id/${a}?partial=1&page=${d}`:`/id/${a}?partial=1`;fetch(m).then(u=>{if(!u.ok)throw new Error("fetch failed");return u.text()}).then(u=>c(parseInt(a),u,!0,d)).catch(u=>{console.error(u),window.location.href=n})}),document.addEventListener("click",e=>{let t=e.target.closest(".drawer-link");if(!t)return;e.preventDefault();let n=t.getAttribute("href");if(!n)return;let s=n+(n.includes("?")?"&partial=1":"?partial=1");fetch(s).then(a=>{if(!a.ok)throw new Error("fetch failed");return a.text()}).then(a=>c(0,a,!1,null)).catch(a=>{console.error(a),window.location.href=n})}),window.addEventListener("popstate",e=>{if(document.body.classList.contains("drawer-open")){let n=location.pathname.match(/\/id\/(\d+)/);if(n){let s=n[1],a=new URLSearchParams(location.search).get("page"),l=a?`/id/${s}?partial=1&page=${a}`:`/id/${s}?partial=1`;fetch(l).then(d=>d.text()).then(d=>c(parseInt(s),d,!1,a))}else o(!1)}else{let t=location.pathname.match(/\/id\/(\d+)/);if(t&&document.querySelector(".id-grid")){let n=t[1],s=new URLSearchParams(location.search).get("page"),a=s?`/id/${n}?partial=1&page=${s}`:`/id/${n}?partial=1`;fetch(a).then(l=>l.text()).then(l=>c(parseInt(n),l,!1,s))}}})}function y(){document.addEventListener("submit",r=>{let i=r.target;if(!i||i.id!=="requestBagForm")return;r.preventDefault();let o=i.querySelector('input[name="email"]'),c=i.querySelector("button[type=submit]"),e=i.querySelector("#requestResult");if(!o||!c||!e)return;let t=o.value.trim();if(!t||!t.includes("@")){e.style.display="block",e.style.color="#d32f2f",e.innerText="Bitte gib eine g\xFCltige E\u2011Mail an.";return}c.disabled=!0,c.innerText="sende...",fetch("/werkzeug-anfordern",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})}).then(n=>n.json()).then(n=>{n.status==="ok"?i.innerHTML='<p style="font-weight:500;">Danke! Wir benachrichtigen dich per E\u2011Mail, sobald ein Werkzeug verf\xFCgbar ist.</p>':(e.style.display="block",e.style.color="#d32f2f",e.innerText=n.error||"Etwas ging schief.",c.disabled=!1,c.innerText="anfragen")}).catch(n=>{e.style.display="block",e.style.color="#d32f2f",e.innerText="Netzwerkfehler. Bitte versuche es erneut.",c.disabled=!1,c.innerText="anfragen"})})}var h;function L(){let r=document.getElementById("playerCity"),i=document.getElementById("cityOptions");if(!r||!i)return;let o="";r.addEventListener("input",()=>{let c=r.value.trim();c.length<2||c===o||(o=c,h&&clearTimeout(h),h=window.setTimeout(()=>{w(c,i)},300))})}async function w(r,i){try{let o=window.NOMINATIM_URL||"http://localhost:8081",c=new URLSearchParams({q:r,format:"json",limit:"10",countrycodes:"de",addressdetails:"1","accept-language":"de"});c.append("featuretype","city");let e=await fetch(`${o}/search?${c.toString()}`);if(!e.ok){console.error("Nominatim API error:",e.statusText);return}let t=await e.json();i.innerHTML="",t.forEach(n=>{let s=document.createElement("option"),a=n.address.city||n.address.town||n.address.village||n.address.municipality||n.name;s.value=a,i.appendChild(s)})}catch(o){console.error("Error fetching cities:",o)}}var b=["\u{1F3E0}","\u{1F194}","\u{1F4AF}","\u{1F6A8}"];function E(r){let i=`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
      <text y="80" font-size="80">${r}</text>
    </svg>
  `;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(i)}`}function v(){return b[Math.floor(Math.random()*b.length)]}function T(){if(typeof document>"u"||!document.head)return;let r=v(),i=E(r),o=document.querySelector("link[rel~='icon']");o||(o=document.createElement("link"),o.rel="icon",document.head.appendChild(o)),o.href=i}T();p(),g(),y(),L(),f();})();
//# sourceMappingURL=main.js.map
