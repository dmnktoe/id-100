"use strict";(()=>{function p(){let n=document.querySelector(".brand-full"),a=document.querySelector(".brand-compact");n&&sessionStorage.getItem("brandAnimated")==="1"&&(n.classList.add("reverse-animated"),sessionStorage.setItem("brandAnimated","0"),setTimeout(()=>{n.classList.remove("reverse-animated")},800)),a&&sessionStorage.getItem("brandAnimated")!=="1"&&(a.classList.add("animated"),sessionStorage.setItem("brandAnimated","1"))}function f(n){let i=Array.from((n||document).querySelectorAll("img.lazy"));if(i.length===0)return;let c=e=>{let t=e.getAttribute("data-lqip");t&&(!e.getAttribute("src")||e.getAttribute("src")?.[0]==="#")&&(e.src=t)};if(i.forEach(e=>{if(e.dataset.lazyInitialized)return;e.dataset.lazyInitialized="1";let t=()=>{let s=e.getAttribute("data-src");try{let o=e.currentSrc||e.src||"";(!s||o===s)&&e.classList.add("loaded")}catch{e.classList.add("loaded")}},r=()=>{e.classList.add("loaded")};e.addEventListener("load",t),e.addEventListener("error",r),c(e),e.complete&&(e.naturalWidth&&e.naturalWidth>0?t():r())}),"IntersectionObserver"in window){let e=new IntersectionObserver((t,r)=>{t.forEach(s=>{if(!s.isIntersecting)return;let o=s.target,d=o.getAttribute("data-src");d&&o.src!==d&&(o.src=d),r.unobserve(o)})},{root:null,rootMargin:"200px",threshold:.01});i.forEach(t=>{t.classList.contains("loaded")||e.observe(t)})}else i.forEach(e=>{let t=e.getAttribute("data-src");t&&!e.classList.contains("loaded")&&e.src!==t&&(e.src=t)})}function g(){let n=document.getElementById("drawer-panel"),a=document.getElementById("drawer-backdrop");if(!n||!a)return;function i(e){let t=n.dataset.drawerPushed==="true";document.body.classList.remove("drawer-open"),n.innerHTML="",n.setAttribute("aria-hidden","true"),a.setAttribute("aria-hidden","true"),e&&t&&history.back(),delete n.dataset.drawerPushed}function c(e,t,r,s){n.innerHTML=t,n.setAttribute("aria-hidden","false"),a.setAttribute("aria-hidden","false"),document.body.classList.add("drawer-open");let o=n.querySelector(".drawer-close");o&&o.addEventListener("click",()=>i(!0),{once:!0});let d=n.querySelector(".drawer-back-link");d&&d.addEventListener("click",l=>{l.preventDefault(),i(!0)},{once:!0});try{f(n),Array.from(n.querySelectorAll("img.lazy")).forEach(l=>{let m=l.getAttribute("data-src");m&&l.src!==m&&(l.src=m)})}catch(l){console.warn("initLazyImages failed",l)}if(r){let l=s?`/id/${e}?page=${s}`:`/id/${e}`;history.pushState({drawer:!0,number:e,page:s},"",l),n.dataset.drawerPushed="true"}else n.dataset.drawerPushed="false"}a.addEventListener("click",()=>i(!0)),document.addEventListener("click",e=>{let t=e.target.closest(".id-card");if(!t)return;e.preventDefault();let r=t.getAttribute("href")||t.querySelector("a")?.getAttribute("href");if(!r)return;let s=r.match(/\/id\/(\d+)/);if(!s)return;let o=s[1],l=new URL(r,window.location.origin).searchParams.get("page"),m=l?`/id/${o}?partial=1&page=${l}`:`/id/${o}?partial=1`;fetch(m).then(u=>{if(!u.ok)throw new Error("fetch failed");return u.text()}).then(u=>c(parseInt(o),u,!0,l)).catch(u=>{console.error(u),window.location.href=r})}),document.addEventListener("click",e=>{let t=e.target.closest(".drawer-link");if(!t)return;e.preventDefault();let r=t.getAttribute("href");if(!r)return;let s=r+(r.includes("?")?"&partial=1":"?partial=1");fetch(s).then(o=>{if(!o.ok)throw new Error("fetch failed");return o.text()}).then(o=>c(0,o,!1,null)).catch(o=>{console.error(o),window.location.href=r})}),window.addEventListener("popstate",e=>{if(document.body.classList.contains("drawer-open")){let r=location.pathname.match(/\/id\/(\d+)/);if(r){let s=r[1],o=new URLSearchParams(location.search).get("page"),d=o?`/id/${s}?partial=1&page=${o}`:`/id/${s}?partial=1`;fetch(d).then(l=>l.text()).then(l=>c(parseInt(s),l,!1,o))}else i(!1)}else{let t=location.pathname.match(/\/id\/(\d+)/);if(t&&document.querySelector(".id-grid")){let r=t[1],s=new URLSearchParams(location.search).get("page"),o=s?`/id/${r}?partial=1&page=${s}`:`/id/${r}?partial=1`;fetch(o).then(d=>d.text()).then(d=>c(parseInt(r),d,!1,s))}}})}function y(){document.addEventListener("submit",n=>{let a=n.target;if(!a||a.id!=="requestBagForm")return;n.preventDefault();let i=a.querySelector('input[name="email"]'),c=a.querySelector("button[type=submit]"),e=a.querySelector("#requestResult");if(!i||!c||!e)return;let t=i.value.trim();if(!t||!t.includes("@")){e.style.display="block",e.style.color="#d32f2f",e.innerText="Bitte gib eine g\xFCltige E\u2011Mail an.";return}c.disabled=!0,c.innerText="sende...",fetch("/werkzeug-anfordern",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})}).then(r=>r.json()).then(r=>{r.status==="ok"?a.innerHTML='<p style="font-weight:500;">Danke! Wir benachrichtigen dich per E\u2011Mail, sobald ein Werkzeug verf\xFCgbar ist.</p>':(e.style.display="block",e.style.color="#d32f2f",e.innerText=r.error||"Etwas ging schief.",c.disabled=!1,c.innerText="anfragen")}).catch(r=>{e.style.display="block",e.style.color="#d32f2f",e.innerText="Netzwerkfehler. Bitte versuche es erneut.",c.disabled=!1,c.innerText="anfragen"})})}var h;function L(){let n=document.getElementById("playerCity"),a=document.getElementById("cityOptions");if(!n||!a)return;let i="";n.addEventListener("input",()=>{let c=n.value.trim();c.length<2||c===i||(i=c,h&&clearTimeout(h),h=window.setTimeout(()=>{E(c,a)},300))})}async function E(n,a){try{let i=window.NOMINATIM_URL||"http://localhost:8081",c=new URLSearchParams({q:n,limit:"10",lang:"de",osm_tag:"place:city"}),e=await fetch(`${i}/api?${c.toString()}`);if(!e.ok){console.error("Photon API error:",e.statusText);return}let t=await e.json();a.innerHTML="";let r=new Set;t.features.forEach(s=>{let o=s.properties.name;if(o&&!r.has(o)){r.add(o);let d=document.createElement("option");d.value=o,a.appendChild(d)}})}catch(i){console.error("Error fetching cities:",i)}}var b=["\u{1F3E0}","\u{1F194}","\u{1F4AF}","\u{1F6A8}"];function w(n){let a=`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
      <text y="80" font-size="80">${n}</text>
    </svg>
  `;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(a)}`}function v(){return b[Math.floor(Math.random()*b.length)]}function T(){if(typeof document>"u"||!document.head)return;let n=v(),a=w(n),i=document.querySelector("link[rel~='icon']");i||(i=document.createElement("link"),i.rel="icon",document.head.appendChild(i)),i.href=a}T();p(),g(),y(),L(),f();})();
//# sourceMappingURL=main.js.map
