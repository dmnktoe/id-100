"use strict";(()=>{function p(){let n=document.querySelector(".brand-full"),o=document.querySelector(".brand-compact");n&&sessionStorage.getItem("brandAnimated")==="1"&&(n.classList.add("reverse-animated"),sessionStorage.setItem("brandAnimated","0"),setTimeout(()=>{n.classList.remove("reverse-animated")},800)),o&&sessionStorage.getItem("brandAnimated")!=="1"&&(o.classList.add("animated"),sessionStorage.setItem("brandAnimated","1"))}function f(n){let s=Array.from((n||document).querySelectorAll("img.lazy"));if(s.length===0)return;let c=e=>{let t=e.getAttribute("data-lqip");t&&(!e.getAttribute("src")||e.getAttribute("src")?.[0]==="#")&&(e.src=t)};if(s.forEach(e=>{if(e.dataset.lazyInitialized)return;e.dataset.lazyInitialized="1";let t=()=>{let a=e.getAttribute("data-src");try{let i=e.currentSrc||e.src||"";(!a||i===a)&&e.classList.add("loaded")}catch{e.classList.add("loaded")}},r=()=>{e.classList.add("loaded")};e.addEventListener("load",t),e.addEventListener("error",r),c(e),e.complete&&(e.naturalWidth&&e.naturalWidth>0?t():r())}),"IntersectionObserver"in window){let e=new IntersectionObserver((t,r)=>{t.forEach(a=>{if(!a.isIntersecting)return;let i=a.target,d=i.getAttribute("data-src");d&&i.src!==d&&(i.src=d),r.unobserve(i)})},{root:null,rootMargin:"200px",threshold:.01});s.forEach(t=>{t.classList.contains("loaded")||e.observe(t)})}else s.forEach(e=>{let t=e.getAttribute("data-src");t&&!e.classList.contains("loaded")&&e.src!==t&&(e.src=t)})}function g(){let n=document.getElementById("drawer-panel"),o=document.getElementById("drawer-backdrop");if(!n||!o)return;function s(e){let t=n.dataset.drawerPushed==="true";document.body.classList.remove("drawer-open"),n.innerHTML="",n.setAttribute("aria-hidden","true"),o.setAttribute("aria-hidden","true"),e&&t&&history.back(),delete n.dataset.drawerPushed}function c(e,t,r,a){n.innerHTML=t,n.setAttribute("aria-hidden","false"),o.setAttribute("aria-hidden","false"),document.body.classList.add("drawer-open");let i=n.querySelector(".drawer-close");i&&i.addEventListener("click",()=>s(!0),{once:!0});let d=n.querySelector(".drawer-back-link");d&&d.addEventListener("click",l=>{l.preventDefault(),s(!0)},{once:!0});try{f(n),Array.from(n.querySelectorAll("img.lazy")).forEach(l=>{let m=l.getAttribute("data-src");m&&l.src!==m&&(l.src=m)})}catch(l){console.warn("initLazyImages failed",l)}if(r){let l=a?`/id/${e}?page=${a}`:`/id/${e}`;history.pushState({drawer:!0,number:e,page:a},"",l),n.dataset.drawerPushed="true"}else n.dataset.drawerPushed="false"}o.addEventListener("click",()=>s(!0)),document.addEventListener("click",e=>{let t=e.target.closest(".id-card");if(!t)return;e.preventDefault();let r=t.getAttribute("href")||t.querySelector("a")?.getAttribute("href");if(!r)return;let a=r.match(/\/id\/(\d+)/);if(!a)return;let i=a[1],l=new URL(r,window.location.origin).searchParams.get("page"),m=l?`/id/${i}?partial=1&page=${l}`:`/id/${i}?partial=1`;fetch(m).then(u=>{if(!u.ok)throw new Error("fetch failed");return u.text()}).then(u=>c(parseInt(i),u,!0,l)).catch(u=>{console.error(u),window.location.href=r})}),document.addEventListener("click",e=>{let t=e.target.closest(".drawer-link");if(!t)return;e.preventDefault();let r=t.getAttribute("href");if(!r)return;let a=r+(r.includes("?")?"&partial=1":"?partial=1");fetch(a).then(i=>{if(!i.ok)throw new Error("fetch failed");return i.text()}).then(i=>c(0,i,!1,null)).catch(i=>{console.error(i),window.location.href=r})}),window.addEventListener("popstate",e=>{if(document.body.classList.contains("drawer-open")){let r=location.pathname.match(/\/id\/(\d+)/);if(r){let a=r[1],i=new URLSearchParams(location.search).get("page"),d=i?`/id/${a}?partial=1&page=${i}`:`/id/${a}?partial=1`;fetch(d).then(l=>l.text()).then(l=>c(parseInt(a),l,!1,i))}else s(!1)}else{let t=location.pathname.match(/\/id\/(\d+)/);if(t&&document.querySelector(".id-grid")){let r=t[1],a=new URLSearchParams(location.search).get("page"),i=a?`/id/${r}?partial=1&page=${a}`:`/id/${r}?partial=1`;fetch(i).then(d=>d.text()).then(d=>c(parseInt(r),d,!1,a))}}})}function b(){document.addEventListener("submit",n=>{let o=n.target;if(!o||o.id!=="requestBagForm")return;n.preventDefault();let s=o.querySelector('input[name="email"]'),c=o.querySelector("button[type=submit]"),e=o.querySelector("#requestResult");if(!s||!c||!e)return;let t=s.value.trim();if(!t||!t.includes("@")){e.style.display="block",e.style.color="#d32f2f",e.innerText="Bitte gib eine g\xFCltige E\u2011Mail an.";return}c.disabled=!0,c.innerText="sende...",fetch("/werkzeug-anfordern",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})}).then(r=>r.json()).then(r=>{r.status==="ok"?o.innerHTML='<p style="font-weight:500;">Danke! Wir benachrichtigen dich per E\u2011Mail, sobald ein Werkzeug verf\xFCgbar ist.</p>':(e.style.display="block",e.style.color="#d32f2f",e.innerText=r.error||"Etwas ging schief.",c.disabled=!1,c.innerText="anfragen")}).catch(r=>{e.style.display="block",e.style.color="#d32f2f",e.innerText="Netzwerkfehler. Bitte versuche es erneut.",c.disabled=!1,c.innerText="anfragen"})})}var h;function y(){let n=document.getElementById("playerCity"),o=document.getElementById("cityOptions");if(!n||!o)return;let s="";n.addEventListener("input",()=>{let c=n.value.trim();c.length<2||c===s||(s=c,h&&clearTimeout(h),h=window.setTimeout(()=>{E(c,o)},300))})}async function E(n,o){try{let s=window.NOMINATIM_URL||"http://localhost:8081",c=await fetch(`${s}/indexes/cities/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q:n,limit:10,attributesToRetrieve:["name"]})});if(!c.ok){console.error("Meilisearch API error:",c.statusText);return}let e=await c.json();o.innerHTML="";let t=new Set;e.hits.forEach(r=>{let a=r.name;if(a&&!t.has(a)){t.add(a);let i=document.createElement("option");i.value=a,o.appendChild(i)}})}catch(s){console.error("Error fetching cities:",s)}}var L=["\u{1F3E0}","\u{1F194}","\u{1F4AF}","\u{1F6A8}"];function w(n){let o=`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
      <text y="80" font-size="80">${n}</text>
    </svg>
  `;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(o)}`}function v(){return L[Math.floor(Math.random()*L.length)]}function T(){if(typeof document>"u"||!document.head)return;let n=v(),o=w(n),s=document.querySelector("link[rel~='icon']");s||(s=document.createElement("link"),s.rel="icon",document.head.appendChild(s)),s.href=o}T();p(),g(),b(),y(),f();})();
//# sourceMappingURL=main.js.map
